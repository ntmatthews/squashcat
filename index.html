<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- ===== Metadata (SEO / Social / App) ===== -->
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SquashCat — Hyperforge Studios (Squash the Cats)</title>
  <meta name="description" content="SquashCat: a fast mini web game by Hyperforge Studios. Jump and stomp cats to rack up a high score in a retro runner vibe." />
  <meta name="author" content="Hyperforge Studios" />
  <meta name="theme-color" content="#111827" />
  <meta name="application-name" content="SquashCat" />

  <!-- Inline SVG favicon styled like the main character -->
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23F3F4F6'/%3E%3Crect x='16' y='16' width='32' height='32' rx='6' fill='%23111827'/%3E%3Crect x='36' y='24' width='6' height='6' fill='%23ffffff'/%3E%3Crect x='22' y='44' width='8' height='6' fill='%230b1220'/%3E%3Crect x='34' y='44' width='8' height='6' fill='%230b1220'/%3E%3C/svg%3E" />

  <!-- Apple touch icon: set a small placeholder, then the script below replaces it with a generated 180x180 PNG -->
  <link id="apple-icon" rel="apple-touch-icon" sizes="180x180"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR4nGP4////fwAJ+wPzq0C4VwAAAABJRU5ErkJggg==" />

  <!-- Social metadata -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SquashCat — Squash the Cats" />
  <meta property="og:description" content="Jump and stomp cats. Simple, fast, and oddly satisfying." />
  <meta property="og:url" content="https://squashcat.hyperforgestudios.com" />
  <!-- OG/Twitter banner: inline SVG (1200x630) -->
  <meta property="og:image"
        content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='%23ffffff'/%3E%3Cstop offset='1' stop-color='%23eef3ff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23g)'/%3E%3Crect x='450' y='210' width='300' height='300' rx='36' fill='%23111827'/%3E%3Crect x='660' y='240' width='36' height='36' fill='%23ffffff'/%3E%3Crect x='510' y='480' width='60' height='36' fill='%230b1220'/%3E%3Crect x='630' y='480' width='60' height='36' fill='%230b1220'/%3E%3Ctext x='600' y='120' text-anchor='middle' font-family='Inter,system-ui,Arial' font-size='64' fill='%23111827'%3ESquashCat%3C/text%3E%3Ctext x='600' y='170' text-anchor='middle' font-family='Inter,system-ui,Arial' font-size='28' fill='%236b7280'%3EJump%20%26%20stomp%20cats%3C/text%3E%3C/svg%3E" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="SquashCat — Squash the Cats" />
  <meta name="twitter:description" content="Jump and stomp cats for points. Can you beat your best score?" />
  <meta name="twitter:image"
        content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='%23ffffff'/%3E%3Cstop offset='1' stop-color='%23eef3ff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23g)'/%3E%3Crect x='450' y='210' width='300' height='300' rx='36' fill='%23111827'/%3E%3Crect x='660' y='240' width='36' height='36' fill='%23ffffff'/%3E%3Crect x='510' y='480' width='60' height='36' fill='%230b1220'/%3E%3Crect x='630' y='480' width='60' height='36' fill='%230b1220'/%3E%3Ctext x='600' y='120' text-anchor='middle' font-family='Inter,system-ui,Arial' font-size='64' fill='%23111827'%3ESquashCat%3C/text%3E%3Ctext x='600' y='170' text-anchor='middle' font-family='Inter,system-ui,Arial' font-size='28' fill='%236b7280'%3EJump%20%26%20stomp%20cats%3C/text%3E%3C/svg%3E" />
  <meta name="twitter:creator" content="@your_handle" />

  <!-- Build info -->
  <meta name="x-build-version" content="0.1.0" />
  <meta name="x-build-timestamp" content="2025-08-09T00:00:00Z" />

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "VideoGame",
    "name": "SquashCat",
    "alternateName": "Squash the Cats",
    "author": { "@type": "Organization", "name": "Hyperforge Studios" },
    "publisher": { "@type": "Organization", "name": "Hyperforge Studios" },
    "applicationCategory": "Game",
    "operatingSystem": "Any",
    "gamePlatform": "Web",
    "inLanguage": "en",
    "url": "https://squashcat.hyperforgestudios.com",
    "description": "A lightweight browser game where you jump and stomp cats to score points.",
    "genre": ["Arcade", "Casual"],
    "keywords": "game, web game, cats, arcade, jump, stomp",
    "image": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='%23ffffff'/%3E%3Cstop offset='1' stop-color='%23eef3ff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23g)'/%3E%3Crect x='450' y='210' width='300' height='300' rx='36' fill='%23111827'/%3E%3Crect x='660' y='240' width='36' height='36' fill='%23ffffff'/%3E%3Crect x='510' y='480' width='60' height='36' fill='%230b1220'/%3E%3Crect x='630' y='480' width='60' height='36' fill='%230b1220'/%3E%3Ctext x='600' y='120' text-anchor='middle' font-family='Inter,system-ui,Arial' font-size='64' fill='%23111827'%3ESquashCat%3C/text%3E%3Ctext x='600' y='170' text-anchor='middle' font-family='Inter,system-ui,Arial' font-size='28' fill='%236b7280'%3EJump%20%26%20stomp%20cats%3C/text%3E%3C/svg%3E"
  }
  </script>

  <!-- Inlined Web App Manifest (attached at runtime as a Blob URL) -->
  <script id="manifest-json" type="application/manifest+json">
  {
    "name": "SquashCat",
    "short_name": "SquashCat",
    "start_url": "./",
    "display": "standalone",
    "background_color": "#111827",
    "theme_color": "#111827",
    "scope": "./",
    "icons": [
      {
        "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23F3F4F6'/%3E%3Crect x='16' y='16' width='32' height='32' rx='6' fill='%23111827'/%3E%3Crect x='36' y='24' width='6' height='6' fill='%23ffffff'/%3E%3Crect x='22' y='44' width='8' height='6' fill='%230b1220'/%3E%3Crect x='34' y='44' width='8' height='6' fill='%230b1220'/%3E%3C/svg%3E",
        "sizes": "any",
        "type": "image/svg+xml",
        "purpose": "any maskable"
      }
    ]
  }
  </script>
  <!-- We attach the manifest link dynamically below to keep this a single file. -->

  <style>
    :root{ --bg:#f7f7f7; --foreground:#111827; --muted:#6b7280; }
    html,body{height:100%;}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--foreground);display:flex;align-items:center;justify-content:center;padding:20px}
    .frame{width:min(980px,96vw);background:linear-gradient(180deg,rgba(255,255,255,0.7),rgba(255,255,255,0.55));border-radius:12px;box-shadow:0 12px 30px rgba(2,6,23,0.12);padding:18px;display:flex;flex-direction:column;gap:18px}
    header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
    header h1{font-size:16px;margin:0}
    header .meta{font-size:12px;color:var(--muted)}
    .stage{background:linear-gradient(#fff,#f3f4f6);border-radius:8px;padding:10px;display:flex;flex-direction:column;align-items:center}
    canvas{width:100%;height:auto;border-radius:6px;background:transparent}
    .hud{display:flex;gap:12px;align-items:center;width:100%;justify-content:space-between}
    .scorebox{background:rgba(17,24,39,0.04);padding:8px 12px;border-radius:8px;font-weight:700}
    .footer{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--muted);flex-wrap:wrap;gap:8px}
    #metaPanelWrap{font-size:12px;color:var(--muted);background:rgba(17,24,39,0.04);border:1px solid rgba(0,0,0,0.05);padding:10px 12px;border-radius:8px}
    #metaPanelWrap summary{cursor:pointer;list-style:none}
    #metaPanel{margin-top:8px;display:grid;grid-template-columns:auto 1fr;gap:4px 12px}
    #metaPanel div.label{font-weight:600}
    @media (max-width:640px){ .frame{padding:12px} }
  </style>
</head>
<body>
  <div class="frame" role="application" aria-label="SquashCat by Hyperforge Studios">
    <header>
      <div>
        <h1>Hyperforge Studios — SquashCat (Squash the Cats)</h1>
        <div class="meta">Jump & stomp cats.</div>
      </div>
      <div class="scorebox" id="bestBox">Best: —</div>
    </header>

    <details id="metaPanelWrap">
      <summary>Game Metadata</summary>
      <div id="metaPanel">
        <div class="label">Version</div><div id="metaVersion">—</div>
        <div class="label">Build Time</div><div id="metaBuildTime">—</div>
        <div class="label">Best Score Stored</div><div id="metaBestScore">—</div>
        <div class="label">Device Pixel Ratio</div><div id="metaDPR">—</div>
        <div class="label">Session Starts</div><div id="metaSessions">—</div>
      </div>
    </details>

    <div class="stage">
      <canvas id="game" width="900" height="200" tabindex="0"></canvas>
      <div class="hud" style="width:100%">
        <div class="controls">Space to jump · Down or S while airborne to stomp · Tap once to jump, tap while airborne to stomp</div>
        <div class="scorebox" id="scoreBox">Squashed: 0</div>
      </div>
    </div>

    <div class="footer">
      <div>Made by Hyperforge Studios</div>
      <div id="status">Ready — press Space to start</div>
    </div>
  </div>

<script>
/* Attach inlined manifest as a Blob URL and generate a PNG apple-touch icon */
(function attachManifestAndAppleIcon(){
  // Manifest
  const el = document.getElementById('manifest-json');
  if (el) {
    const blob = new Blob([el.textContent], {type: 'application/manifest+json'});
    const url = URL.createObjectURL(blob);
    let link = document.querySelector('link[rel="manifest"]');
    if(!link){ link = document.createElement('link'); link.rel = 'manifest'; document.head.appendChild(link); }
    link.href = url;
  }

  // Apple touch icon PNG (180x180) dynamically rendered from the same "main character" shape
  try {
    const cnv = document.createElement('canvas');
    cnv.width = 180; cnv.height = 180;
    const c = cnv.getContext('2d');

    // rounded background
    const bg = '#F3F4F6';
    const fg = '#111827';
    const leg = '#0b1220';

    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

    // background card
    c.clearRect(0,0,180,180);
    c.fillStyle = bg; roundRect(c, 0, 0, 180, 180, 24); c.fill();

    // body
    c.fillStyle = fg;
    roundRect(c, 44, 44, 92, 92, 12); c.fill();

    // eye
    c.fillStyle = '#ffffff';
    c.fillRect(44+56, 44+24, 14, 14);

    // legs
    c.fillStyle = leg;
    c.fillRect(44+12, 44+92-6, 24, 14);
    c.fillRect(44+52, 44+92-6, 24, 14);

    const url = cnv.toDataURL('image/png');
    const apple = document.getElementById('apple-icon');
    if (apple) apple.href = url;
  } catch (e) {
    // leave the tiny placeholder if canvas is blocked
  }
})();
</script>

<script>
// === Game code (with inline comments kept short) ===

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// Populate metadata panel
(function(){
  const v = document.querySelector('meta[name="x-build-version"]')?.content || '—';
  const t = document.querySelector('meta[name="x-build-timestamp"]')?.content || '—';
  document.getElementById('metaVersion').textContent = v;
  document.getElementById('metaBuildTime').textContent = t;
  const metaBestScore = document.getElementById('metaBestScore');
  const metaDPR = document.getElementById('metaDPR');
  const metaSessions = document.getElementById('metaSessions');
  let sessionCount = Number(localStorage.getItem('forge_dino_sessions') || 0) + 1;
  localStorage.setItem('forge_dino_sessions', sessionCount);
  metaSessions.textContent = sessionCount;
  metaDPR.textContent = (window.devicePixelRatio || 1).toFixed(2);
})();

// DPR handling
let DPR = Math.max(window.devicePixelRatio || 1, 1);
function resize(){ const r = canvas.getBoundingClientRect(); canvas.width = Math.floor(r.width * DPR); canvas.height = Math.floor(r.height * DPR); ctx.setTransform(DPR,0,0,DPR,0,0); }
function initCanvasSize(){ const w = Math.min(900, Math.max(320, window.innerWidth * 0.9)); canvas.style.width = w + 'px'; canvas.style.height = '200px'; resize(); }
initCanvasSize();
window.addEventListener('resize', ()=>{ DPR = Math.max(window.devicePixelRatio || 1,1); initCanvasSize(); });

// State
let running=false, gameOver=false, frames=0, score=0;
let baseSpeed=2, speed=baseSpeed, spawnTimer=0;
let obstacles=[], clouds=[], particles=[];
let best = JSON.parse(localStorage.getItem('forge_dino_best') || 'null');
const bestBox=document.getElementById('bestBox'), scoreBox=document.getElementById('scoreBox'), status=document.getElementById('status');
function updateBestUI(){ bestBox.textContent = best ? `Best: ${best.score}` : 'Best: —'; const m=document.getElementById('metaBestScore'); if(m) m.textContent = best ? best.score : '—'; }
updateBestUI();

// Audio (tiny sfx)
let audioCtx=null;
function ensureAudio(){ if(!audioCtx){ try{ audioCtx=new (window.AudioContext||window.webkitAudioContext)(); }catch(e){ audioCtx=null; }}}
function sfxStomp(){ ensureAudio(); if(!audioCtx) return; const t=audioCtx.currentTime,o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(180,t); o.frequency.exponentialRampToValueAtTime(80,t+0.12); g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.18,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+0.26); o.connect(g); g.connect(audioCtx.destination); o.start(t); o.stop(t+0.3); }
function sfxGameOver(){ ensureAudio(); if(!audioCtx) return; const t=audioCtx.currentTime,o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(120,t); o.frequency.exponentialRampToValueAtTime(40,t+0.5); g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.12,t+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t+0.6); o.connect(g); g.connect(audioCtx.destination); o.start(t); o.stop(t+0.7); }

// Particles
class Particle{ constructor(x,y){ this.x=x; this.y=y; this.vx=(Math.random()-0.5)*2; this.vy=-Math.random()*2-0.5; this.life=30+Math.random()*20; this.size=2+Math.random()*3; this.color=`hsla(${Math.floor(10+Math.random()*40)},70%,40%,1)`;} update(){ this.x+=this.vx; this.y+=this.vy; this.vy+=0.12; this.life--; } draw(ctx){ ctx.save(); ctx.globalAlpha=Math.max(0,this.life/50); ctx.fillStyle=this.color; ctx.fillRect(this.x,this.y,this.size,this.size); ctx.restore(); }}

// Player
class Dino{
  constructor(){ this.x=60; this.groundY=150; this.w=44; this.h=44; this.y=this.groundY-this.h; this.vy=0; this.gravity=0.6; this.jumpPower=-11; this.jumping=false; this.ducking=false; this.step=0; this.stomping=false; }
  jump(){ if(!this.jumping && !gameOver){ this.vy=this.jumpPower; this.jumping=true; this.stomping=false; } }
  stomp(){ if(this.jumping && !this.stomping && !gameOver){ this.stomping=true; this.vy=18; sfxStomp(); } }
  duck(t){ this.ducking=!!t; this.h=this.ducking?26:44; if(!this.ducking && this.y>this.groundY-this.h) this.y=this.groundY-this.h; }
  update(){ if(gameOver) return; this.vy+=this.gravity; this.y+=this.vy; if(this.y>=this.groundY-this.h){ this.y=this.groundY-this.h; this.vy=0; this.jumping=false; this.stomping=false; } this.step=(this.step+0.15)%2; }
  draw(ctx){ ctx.save(); ctx.fillStyle='#111827'; ctx.fillRect(this.x,this.y,this.w,this.h); ctx.fillStyle='#fff'; ctx.fillRect(this.x+Math.floor(this.w*0.65),this.y+8,6,6); if(this.stomping){ ctx.fillStyle='rgba(123,30,30,0.12)'; ctx.fillRect(this.x-6,this.y+this.h-4,this.w+12,8);} ctx.fillStyle='#0b1220'; if(!this.jumping){ const leg=(this.step<1)?5:0; ctx.fillRect(this.x+8,this.y+this.h-6+leg,8,6); ctx.fillRect(this.x+26,this.y+this.h-6-leg,8,6);} else { ctx.fillRect(this.x+8,this.y+this.h-6,8,6); ctx.fillRect(this.x+26,this.y+this.h-6,8,6);} ctx.restore(); }
  bounds(){ return {x:this.x,y:this.y,w:this.w,h:this.h}; }
}
const dino=new Dino();

// Obstacles & clouds
class Obstacle{ constructor(type=0){ this.type=type; this.squashed=false; this.w=type===0?22:(type===1?36:36); this.h=type===0?30:(type===1?44:28); this.x=(canvas.width/DPR)+10; this.y=150-this.h; this.frame=0; this.removal=0;} update(){ if(gameOver) return; this.x-=speed; if(this.type===2) this.frame=(this.frame+0.3)%2; if(this.squashed) this.removal++; } draw(ctx){ ctx.save(); if(this.squashed){ ctx.fillStyle='#7b1e1e'; ctx.fillRect(this.x-4,this.y+this.h-10,this.w+8,8);} else { if(this.type===2){ const yy=this.y-18; ctx.fillStyle='#0b1220'; ctx.fillRect(this.x,yy,this.w,this.h); if(this.frame<1) ctx.fillRect(this.x+4,yy-6,12,6); else ctx.fillRect(this.x+4,yy+this.h-4,12,6);} else { ctx.fillStyle='#0b1220'; ctx.fillRect(this.x,this.y+6,this.w,this.h-6); ctx.fillRect(this.x+Math.floor(this.w*0.1),this.y-6,Math.floor(this.w*0.6),12); ctx.beginPath(); ctx.moveTo(this.x+4,this.y-6); ctx.lineTo(this.x+8,this.y-16); ctx.lineTo(this.x+14,this.y-6); ctx.closePath(); ctx.fill(); ctx.beginPath(); ctx.moveTo(this.x+this.w-14,this.y-6); ctx.lineTo(this.x+this.w-8,this.y-16); ctx.lineTo(this.x+this.w-4,this.y-6); ctx.closePath(); ctx.fill(); ctx.fillStyle='#fff'; ctx.fillRect(this.x+Math.floor(this.w*0.25),this.y+8,4,4); ctx.fillRect(this.x+Math.floor(this.w*0.6),this.y+8,4,4); ctx.fillStyle='#0b1220'; ctx.fillRect(this.x+this.w-6,this.y+12,6,4);} } ctx.restore(); } offscreen(){ return this.x+this.w<-30 || this.removal>30; } bounds(){ return {x:this.x,y:this.y,w:this.w,h:this.h}; } }
class Cloud{ constructor(){ this.x=canvas.width/DPR+Math.random()*200; this.y=20+Math.random()*40; this.w=48+Math.random()*60; this.vx=-(speed*0.35);} update(){ if(gameOver) return; this.x+=this.vx;} draw(ctx){ ctx.save(); ctx.fillStyle='#e6eef7'; ctx.fillRect(this.x,this.y,this.w,16); ctx.fillRect(this.x-12,this.y+4,28,10); ctx.restore(); }}

// Helpers
function spawnObstacle(){ const r=Math.random(); obstacles.push(new Obstacle(r<0.7?0:(r<0.95?1:2))); }
function spawnCloud(){ clouds.push(new Cloud()); }
function rectsIntersect(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }

// Reset / UI
function resetGame(){ running=false; gameOver=false; frames=0; score=0; speed=baseSpeed; obstacles=[]; clouds=[]; particles=[]; spawnTimer=0; dino.y=dino.groundY-dino.h; dino.vy=0; dino.jumping=false; dino.stomping=false; status.textContent='Ready — press Space to start'; updateScoreUI(); }
resetGame();
function updateScoreUI(){ scoreBox.textContent=`Squashed: ${score}`; }

// Sky gradient (start at day)
function skyGradient(t){ const p=40, phase=-Math.PI/2; const a=(Math.sin((t/p)*Math.PI*2+phase)+1)/2; const dayTop=[255,255,255], dayBot=[238,243,255], nightTop=[18,24,49], nightBot=[8,12,28]; const lerp=(c0,c1,a)=>c0.map((v,i)=>Math.round(v*(1-a)+c1[i]*a)); const top=lerp(dayTop,nightTop,a), bot=lerp(dayBot,nightBot,a); return {top:`rgb(${top.join(',')})`, bot:`rgb(${bot.join(',')})`, nightAlpha:a}; }

// Loop
function gameLoop(){
  if(running && !gameOver) frames++;
  const t=frames/60, cw=canvas.width/DPR, ch=canvas.height/DPR;

  // Background + sun/moon
  const sky=skyGradient(t);
  const grad=ctx.createLinearGradient(0,0,0,ch); grad.addColorStop(0,sky.top); grad.addColorStop(1,sky.bot); ctx.fillStyle=grad; ctx.fillRect(0,0,cw,ch);
  const nightA=sky.nightAlpha, sunX=(cw*0.8)-Math.sin(t/6)*60, sunY=36+Math.cos(t/6)*12;
  ctx.save(); ctx.globalAlpha=1-nightA; ctx.beginPath(); ctx.fillStyle='#ffd166'; ctx.arc(sunX,sunY,18,0,Math.PI*2); ctx.fill(); ctx.restore();
  ctx.save(); ctx.globalAlpha=nightA; ctx.beginPath(); ctx.fillStyle='#e6eef7'; ctx.arc(sunX-10,sunY+6,12,0,Math.PI*2); ctx.fill(); ctx.restore();

  // Clouds
  if(running && !gameOver && frames%160===0) spawnCloud();
  clouds.forEach((c,i)=>{ c.draw(ctx); if(!gameOver) c.update(); if(c.x+c.w<-50) clouds.splice(i,1); });

  // Ground
  ctx.fillStyle = nightA>0.5 ? '#0b1220' : '#111827'; ctx.fillRect(0,150,cw,4);
  ctx.fillStyle = nightA>0.5 ? '#1f2937' : '#cbd5e1'; for(let x=0;x<cw;x+=12){ ctx.fillRect(x,154,6,2); }

  // Spawns + speed
  if(running && !gameOver){ spawnTimer--; if(spawnTimer<=0){ spawnTimer=140+Math.random()*120-Math.min(60,Math.floor(score/3)); spawnObstacle(); } speed=baseSpeed+Math.floor(score/10); }

  // Obstacles/particles
  obstacles.forEach((o,i)=>{ o.draw(ctx); if(!gameOver) o.update(); if(o.offscreen()) obstacles.splice(i,1); });
  particles.forEach((p,i)=>{ p.update(); p.draw(ctx); if(p.life<=0) particles.splice(i,1); });

  // Player
  dino.draw(ctx); if(running && !gameOver) dino.update();

  // Collisions
  if(running && !gameOver){
    for(const o of obstacles){
      if(o.squashed) continue;
      if(rectsIntersect(dino.bounds(), o.bounds())){
        if(dino.stomping){
          o.squashed=true; o.removal=0; dino.vy=-8; dino.stomping=false; score++; updateScoreUI(); sfxStomp();
          const px=o.x+o.w/2, py=o.y+o.h/2; for(let n=0;n<18;n++) particles.push(new Particle(px+(Math.random()-0.5)*10, py+(Math.random()-0.5)*6));
          if(!best || score>best.score){ best={score, when:new Date().toISOString()}; localStorage.setItem('forge_dino_best', JSON.stringify(best)); updateBestUI(); }
        } else {
          gameOver=true; running=false; status.textContent='Game Over — press Space to restart'; sfxGameOver(); break;
        }
      }
    }
  }

  // Idle hint
  if(!running && !gameOver){ ctx.save(); ctx.fillStyle = nightA>0.5 ? '#f3f4f6' : '#111827'; ctx.font='14px Inter,Arial'; ctx.textAlign='center'; ctx.fillText('Press Space or Tap to start — stomp cats to score (tap while airborne to stomp)', cw/2, 90); ctx.restore(); }

  // Overlay
  if(gameOver){ ctx.save(); ctx.fillStyle='rgba(255,255,255,0.6)'; ctx.fillRect(0,0,cw,ch); ctx.fillStyle='#111827'; ctx.font='18px Inter,Arial'; ctx.textAlign='center'; ctx.fillText('Game Over', cw/2, ch/2-10); ctx.font='14px Inter,Arial'; ctx.fillText('Press Space or Tap to restart', cw/2, ch/2+14); ctx.restore(); }

  requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);

// Input
function startIfNeeded(){ if(!running && !gameOver){ running=true; status.textContent='Playing'; } }
document.addEventListener('keydown',(e)=>{ if(e.code==='Space'||e.code==='ArrowUp'||e.key==='w'){ e.preventDefault(); if(gameOver){ resetGame(); startIfNeeded(); } startIfNeeded(); dino.jump(); } if(e.code==='ArrowDown'||e.key==='s'){ e.preventDefault(); if(dino.jumping) dino.stomp(); else dino.duck(true); }});
document.addEventListener('keyup',(e)=>{ if(e.code==='ArrowDown'||e.key==='s'){ if(!dino.jumping) dino.duck(false); }});
canvas.addEventListener('pointerdown',()=>{ if(gameOver){ resetGame(); startIfNeeded(); } startIfNeeded(); if(dino.jumping) dino.stomp(); else dino.jump(); });
canvas.addEventListener('click',()=>canvas.focus());

// Seed clouds
for(let i=0;i<2;i++) clouds.push(new Cloud());

// Debug helpers
window.ForgeDino = { reset: resetGame, start: ()=>{ running=true; status.textContent='Playing'; }, getScore: ()=>score };
</script>
</body>
</html>
